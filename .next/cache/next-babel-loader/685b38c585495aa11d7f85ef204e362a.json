{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _jsxFileName = \"/home/ankit/xeggo/put/Ramp_interface/components/BuyWidget.tsx\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useReducer, useState } from \"react\";\nimport useSWR from \"swr\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { parseEther } from \"@ethersproject/units\";\nimport Account from \"./Account\";\nimport useContract from \"../hooks/useContract\";\nimport useEagerConnect from \"../hooks/useEagerConnect\";\nimport { constants } from \"../util\";\nimport Comptroller from \"../abi/Comptroller.json\";\n\nvar fetcher = function fetcher() {\n  return fetch(arguments.length <= 0 ? undefined : arguments[0], arguments.length <= 1 ? undefined : arguments[1]).then(function (res) {\n    return res.json();\n  });\n};\n\nvar defaultFormData = {\n  paymentid: \"\",\n  amount: \"\",\n  fiat: \"\",\n  escrow: \"\"\n};\n\nvar formReducer = function formReducer(state, event) {\n  if (event.reset) {\n    return defaultFormData;\n  }\n\n  return _objectSpread(_objectSpread({}, state), {}, _defineProperty({}, event.name, event.value));\n};\n\nexport default function Buy() {\n  _s();\n\n  var _useReducer = useReducer(formReducer, defaultFormData),\n      formData = _useReducer[0],\n      setFormData = _useReducer[1];\n\n  var _useState = useState(false),\n      submitting = _useState[0],\n      setSubmitting = _useState[1];\n\n  var _useState2 = useState(false),\n      reverted = _useState2[0],\n      setReverted = _useState2[1];\n\n  var triedToEagerConnect = useEagerConnect();\n  var comptroller = useContract(constants.COMPTROLLER_ADDRESS, Comptroller, true);\n\n  var _useWeb3React = useWeb3React(),\n      library = _useWeb3React.library,\n      account = _useWeb3React.account;\n\n  var isConnected = typeof account === \"string\" && !!library;\n\n  var _useSWR = useSWR('/api/prices', fetcher, {\n    refreshInterval: 5000\n  }),\n      data = _useSWR.data,\n      error = _useSWR.error;\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              event.preventDefault();\n              setSubmitting(true);\n              setReverted(false);\n              _context.next = 5;\n              return comptroller.requestFiatPayment(formData.escrow || constants.ESCROW_ADDRESS, account, parseEther(formData.amount), formData.paymentid).then(function (res) {\n                setFormData({\n                  reset: true\n                });\n              })[\"catch\"](function (e) {\n                if (e.code == -32016) setReverted(true);\n                console.error(e);\n              })[\"finally\"](function () {\n                return setSubmitting(false);\n              });\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleChange = function handleChange(event) {\n    setFormData({\n      name: event.target.name,\n      value: event.target.value\n    });\n  };\n\n  var calFiatAmount = function calFiatAmount(res) {\n    if (!res) return;\n    if (!formData.amount) return \"\";\n    var price = res.ethinr.last;\n    return (formData.amount * price).toString();\n  };\n\n  return __jsx(\"form\", {\n    className: \"bg-white shadow-md rounded-lg px-8 pt-6 pb-8 mb-4\",\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: \"mb-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }\n  }, __jsx(\"label\", {\n    className: \"block text-gray-700 text-xs mb-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 9\n    }\n  }, \"Buy\"), __jsx(\"input\", {\n    className: \"w-auto appearance-none border-2 border-gray-200 rounded py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:border-purple-500\",\n    name: \"amount\",\n    disabled: submitting,\n    inputMode: \"decimal\",\n    type: \"text\",\n    pattern: \"^[0-9]*[.,]?[0-9]*$\",\n    autoComplete: \"off\",\n    autoCorrect: \"off\",\n    minLength: 1,\n    maxLength: 79,\n    spellCheck: \"false\",\n    placeholder: \"0.0\",\n    onChange: handleChange,\n    value: formData.amount,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 9\n    }\n  }), __jsx(\"div\", {\n    className: \"w-auto inline-block p-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 9\n    }\n  }, \"ETH\")), __jsx(\"div\", {\n    className: \"mb-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }\n  }, __jsx(\"label\", {\n    className: \"block text-gray-700 text-xs mb-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }\n  }, \"For (estimated)\"), __jsx(\"input\", {\n    className: \"w-auto appearance-none border-2 border-gray-200 rounded py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:border-purple-500\",\n    name: \"fiat\",\n    disabled: submitting,\n    inputMode: \"decimal\",\n    type: \"text\",\n    pattern: \"^[0-9]*[.,]?[0-9]*$\",\n    autoComplete: \"off\",\n    autoCorrect: \"off\",\n    minLength: 1,\n    maxLength: 79,\n    spellCheck: \"false\",\n    placeholder: \"0.0\",\n    onChange: handleChange,\n    value: calFiatAmount(data),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }\n  }), __jsx(\"div\", {\n    className: \"w-auto inline-block p-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 9\n    }\n  }, \"INR\")), __jsx(\"div\", {\n    className: \"mb-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 7\n    }\n  }, __jsx(\"label\", {\n    className: \"block text-gray-700 text-xs mb-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 9\n    }\n  }, \"UPI ID\"), __jsx(\"input\", {\n    className: \"appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:border-purple-500\",\n    name: \"paymentid\",\n    disabled: submitting,\n    type: \"text\",\n    minLength: 1,\n    maxLength: 79,\n    placeholder: \"unique_Id\",\n    onChange: handleChange,\n    value: formData.paymentid,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 9\n    }\n  })), __jsx(\"div\", {\n    className: \"mb-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 7\n    }\n  }, __jsx(\"label\", {\n    className: \"block text-gray-700 text-xs mb-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 9\n    }\n  }, \"Escrow address (optional)\"), __jsx(\"input\", {\n    className: \"appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:border-purple-500\",\n    name: \"escrow\",\n    disabled: submitting,\n    type: \"text\",\n    minLength: 1,\n    maxLength: 79,\n    placeholder: constants.ESCROW_ADDRESS,\n    onChange: handleChange,\n    value: formData.escrow,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 9\n    }\n  })), reverted && // or link\n  __jsx(\"div\", {\n    className: \"w-full flex pt-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 11\n    }\n  }, \"Not enough funds in escrow...\"), __jsx(\"div\", {\n    className: \"w-full flex pt-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 7\n    }\n  }, isConnected ? __jsx(\"button\", {\n    type: \"submit\",\n    disabled: submitting,\n    className: \"btn-blue m-auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 11\n    }\n  }, \"Pay\") : __jsx(\"div\", {\n    className: \"m-auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 11\n    }\n  }, __jsx(Account, {\n    triedToEagerConnect: triedToEagerConnect,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 13\n    }\n  }))));\n}\n\n_s(Buy, \"XgBiiVVhRpbF9FkAzaOSbDvzCuM=\", false, function () {\n  return [useEagerConnect, useContract, useWeb3React, useSWR];\n});\n\n_c = Buy;\n\nvar _c;\n\n$RefreshReg$(_c, \"Buy\");","map":{"version":3,"sources":["/home/ankit/xeggo/put/Ramp_interface/components/BuyWidget.tsx"],"names":["React","useReducer","useState","useSWR","useWeb3React","parseEther","Account","useContract","useEagerConnect","constants","Comptroller","fetcher","fetch","then","res","json","defaultFormData","paymentid","amount","fiat","escrow","formReducer","state","event","reset","name","value","Buy","formData","setFormData","submitting","setSubmitting","reverted","setReverted","triedToEagerConnect","comptroller","COMPTROLLER_ADDRESS","library","account","isConnected","refreshInterval","data","error","handleSubmit","preventDefault","requestFiatPayment","ESCROW_ADDRESS","e","code","console","handleChange","target","calFiatAmount","price","ethinr","last","toString"],"mappings":"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","sourcesContent":["import React, { useReducer, useState } from \"react\";\nimport Link from \"next/link\";\nimport useSWR from \"swr\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { parseEther } from \"@ethersproject/units\";\n\nimport Account from \"./Account\";\nimport useContract from \"../hooks/useContract\";\nimport useEagerConnect from \"../hooks/useEagerConnect\";\nimport { constants } from \"../util\";\n\nimport Comptroller from \"../abi/Comptroller.json\";\n\nconst fetcher = (...args) => fetch(args[0], args[1]).then(res => res.json());\nconst defaultFormData = {\n  paymentid: \"\",\n  amount: \"\",\n  fiat: \"\",\n  escrow: \"\",\n};\n\nconst formReducer = (state, event) => {\n  if (event.reset) {\n    return defaultFormData;\n  }\n\n  return {\n    ...state,\n    [event.name]: event.value,\n  };\n};\n\nexport default function Buy() {\n  const [formData, setFormData] = useReducer(formReducer, defaultFormData);\n  const [submitting, setSubmitting] = useState(false);\n  const [reverted, setReverted] = useState(false);\n  const triedToEagerConnect = useEagerConnect();\n  const comptroller = useContract(\n    constants.COMPTROLLER_ADDRESS,\n    Comptroller,\n    true,\n  );\n  const { library, account } = useWeb3React();\n  const isConnected = typeof account === \"string\" && !!library;\n  const { data, error } = useSWR('/api/prices', fetcher, { refreshInterval: 5000 });\n\n  const handleSubmit = async (event) => {\n    event.preventDefault();\n    setSubmitting(true);\n    setReverted(false);\n\n    await comptroller\n      .requestFiatPayment(\n        formData.escrow || constants.ESCROW_ADDRESS,\n        account,\n        parseEther(formData.amount),\n        formData.paymentid,\n      )\n      .then((res) => {\n        setFormData({\n          reset: true,\n        });\n      })\n      .catch((e) => {\n        if (e.code == -32016)\n          setReverted(true);\n        console.error(e)\n      })\n      .finally(() => setSubmitting(false));\n  };\n\n  const handleChange = (event) => {\n    setFormData({\n      name: event.target.name,\n      value: event.target.value,\n    });\n  };\n\n  const calFiatAmount = (res) => {\n    if (!res) return;\n    if (!formData.amount) return \"\";\n    const price = res.ethinr.last;\n    return (formData.amount * price).toString();\n  }\n\n  return (\n    <form\n      className=\"bg-white shadow-md rounded-lg px-8 pt-6 pb-8 mb-4\"\n      onSubmit={handleSubmit}\n    >\n      <div className=\"mb-4\">\n        <label className=\"block text-gray-700 text-xs mb-2\">Buy</label>\n        <input\n          className=\"w-auto appearance-none border-2 border-gray-200 rounded py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:border-purple-500\"\n          name=\"amount\"\n          disabled={submitting}\n          inputMode=\"decimal\"\n          type=\"text\"\n          pattern=\"^[0-9]*[.,]?[0-9]*$\"\n          autoComplete=\"off\"\n          autoCorrect=\"off\"\n          minLength={1}\n          maxLength={79}\n          spellCheck=\"false\"\n          placeholder=\"0.0\"\n          onChange={handleChange}\n          value={formData.amount}\n        />\n        <div className=\"w-auto inline-block p-2\">ETH</div>\n      </div>\n\n      <div className=\"mb-4\">\n        <label className=\"block text-gray-700 text-xs mb-2\">For (estimated)</label>\n        <input\n          className=\"w-auto appearance-none border-2 border-gray-200 rounded py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:border-purple-500\"\n          name=\"fiat\"\n          disabled={submitting}\n          inputMode=\"decimal\"\n          type=\"text\"\n          pattern=\"^[0-9]*[.,]?[0-9]*$\"\n          autoComplete=\"off\"\n          autoCorrect=\"off\"\n          minLength={1}\n          maxLength={79}\n          spellCheck=\"false\"\n          placeholder=\"0.0\"\n          onChange={handleChange}\n          value={calFiatAmount(data)}\n        />\n        <div className=\"w-auto inline-block p-2\">INR</div>\n      </div>\n\n      <div className=\"mb-4\">\n        <label className=\"block text-gray-700 text-xs mb-2\">UPI ID</label>\n        <input\n          className=\"appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:border-purple-500\"\n          name=\"paymentid\"\n          disabled={submitting}\n          type=\"text\"\n          minLength={1}\n          maxLength={79}\n          placeholder=\"unique_Id\"\n          onChange={handleChange}\n          value={formData.paymentid}\n        />\n      </div>\n\n      <div className=\"mb-4\">\n        <label className=\"block text-gray-700 text-xs mb-2\">Escrow address (optional)</label>\n        <input\n          className=\"appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:border-purple-500\"\n          name=\"escrow\"\n          disabled={submitting}\n          type=\"text\"\n          minLength={1}\n          maxLength={79}\n          placeholder={constants.ESCROW_ADDRESS}\n          onChange={handleChange}\n          value={formData.escrow}\n        />\n      </div>\n\n        {reverted && (\n          // or link\n          <div className=\"w-full flex pt-4\">\n            Not enough funds in escrow...\n          </div>\n        )}\n\n      <div className=\"w-full flex pt-4\">\n        {isConnected ? (\n          <button\n            type=\"submit\"\n            disabled={submitting}\n            className=\"btn-blue m-auto\">\n            Pay\n          </button>\n        ) : (\n          <div className=\"m-auto\">\n            <Account triedToEagerConnect={triedToEagerConnect}/>\n          </div>\n        )}\n      </div>\n    </form>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}