{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useReducer, useState } from \"react\";\nimport useSWR from \"swr\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { parseEther } from \"@ethersproject/units\";\nimport Account from \"./Account\";\nimport useContract from \"../hooks/useContract\";\nimport useEagerConnect from \"../hooks/useEagerConnect\";\nimport { constants } from \"../util\";\nimport Comptroller from \"../abi/Comptroller.json\";\n\nvar fetcher = function fetcher() {\n  return fetch(arguments.length <= 0 ? undefined : arguments[0], arguments.length <= 1 ? undefined : arguments[1]).then(function (res) {\n    return res.json();\n  });\n};\n\nvar defaultFormData = {\n  paymentid: \"\",\n  amount: \"\",\n  fiat: \"\",\n  escrow: \"\"\n};\n\nvar formReducer = function formReducer(state, event) {\n  if (event.reset) {\n    return defaultFormData;\n  }\n\n  return _objectSpread(_objectSpread({}, state), {}, _defineProperty({}, event.name, event.value));\n};\n\nexport default function Buy() {\n  var _useReducer = useReducer(formReducer, defaultFormData),\n      formData = _useReducer[0],\n      setFormData = _useReducer[1];\n\n  var _useState = useState(false),\n      submitting = _useState[0],\n      setSubmitting = _useState[1];\n\n  var _useState2 = useState(false),\n      reverted = _useState2[0],\n      setReverted = _useState2[1];\n\n  var triedToEagerConnect = useEagerConnect();\n  var comptroller = useContract(constants.COMPTROLLER_ADDRESS, Comptroller, true);\n\n  var _useWeb3React = useWeb3React(),\n      library = _useWeb3React.library,\n      account = _useWeb3React.account;\n\n  var isConnected = typeof account === \"string\" && !!library;\n\n  var _useSWR = useSWR('/api/prices', fetcher, {\n    refreshInterval: 5000\n  }),\n      data = _useSWR.data,\n      error = _useSWR.error;\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              event.preventDefault();\n              setSubmitting(true);\n              setReverted(false);\n              _context.next = 5;\n              return comptroller.requestFiatPayment(formData.escrow || constants.ESCROW_ADDRESS, account, parseEther(formData.amount), formData.paymentid).then(function (res) {\n                setFormData({\n                  reset: true\n                });\n              })[\"catch\"](function (e) {\n                if (e.code == -32016) setReverted(true);\n                console.error(e);\n              })[\"finally\"](function () {\n                return setSubmitting(false);\n              });\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleChange = function handleChange(event) {\n    setFormData({\n      name: event.target.name,\n      value: event.target.value\n    });\n  };\n\n  var calFiatAmount = function calFiatAmount(res) {\n    if (!res) return;\n    if (!formData.amount) return \"\";\n    var price = res.ethinr.last;\n    return (formData.amount * price).toString();\n  };\n\n  return __jsx(\"form\", {\n    className: \"bg-white shadow-md rounded-lg px-8 pt-6 pb-8 mb-4\",\n    onSubmit: handleSubmit\n  }, __jsx(\"div\", {\n    className: \"mb-4\"\n  }, __jsx(\"label\", {\n    className: \"block text-gray-700 text-xs mb-2\"\n  }, \"Buy\"), __jsx(\"input\", {\n    className: \"w-auto appearance-none border-2 border-gray-200 rounded py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:border-purple-500\",\n    name: \"amount\",\n    disabled: submitting,\n    inputMode: \"decimal\",\n    type: \"text\",\n    pattern: \"^[0-9]*[.,]?[0-9]*$\",\n    autoComplete: \"off\",\n    autoCorrect: \"off\",\n    minLength: 1,\n    maxLength: 79,\n    spellCheck: \"false\",\n    placeholder: \"0.0\",\n    onChange: handleChange,\n    value: formData.amount\n  }), __jsx(\"div\", {\n    className: \"w-auto inline-block p-2\"\n  }, \"ETH\")), __jsx(\"div\", {\n    className: \"mb-4\"\n  }, __jsx(\"label\", {\n    className: \"block text-gray-700 text-xs mb-2\"\n  }, \"For (estimated)\"), __jsx(\"input\", {\n    className: \"w-auto appearance-none border-2 border-gray-200 rounded py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:border-purple-500\",\n    name: \"fiat\",\n    disabled: submitting,\n    inputMode: \"decimal\",\n    type: \"text\",\n    pattern: \"^[0-9]*[.,]?[0-9]*$\",\n    autoComplete: \"off\",\n    autoCorrect: \"off\",\n    minLength: 1,\n    maxLength: 79,\n    spellCheck: \"false\",\n    placeholder: \"0.0\",\n    onChange: handleChange,\n    value: calFiatAmount(data)\n  }), __jsx(\"div\", {\n    className: \"w-auto inline-block p-2\"\n  }, \"INR\")), __jsx(\"div\", {\n    className: \"mb-4\"\n  }, __jsx(\"label\", {\n    className: \"block text-gray-700 text-xs mb-2\"\n  }, \"UPI ID\"), __jsx(\"input\", {\n    className: \"appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:border-purple-500\",\n    name: \"paymentid\",\n    disabled: submitting,\n    type: \"text\",\n    minLength: 1,\n    maxLength: 79,\n    placeholder: \"unique_Id\",\n    onChange: handleChange,\n    value: formData.paymentid\n  })), __jsx(\"div\", {\n    className: \"mb-4\"\n  }, __jsx(\"label\", {\n    className: \"block text-gray-700 text-xs mb-2\"\n  }, \"Escrow address (optional)\"), __jsx(\"input\", {\n    className: \"appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:border-purple-500\",\n    name: \"escrow\",\n    disabled: submitting,\n    type: \"text\",\n    minLength: 1,\n    maxLength: 79,\n    placeholder: constants.ESCROW_ADDRESS,\n    onChange: handleChange,\n    value: formData.escrow\n  })), reverted && // or link\n  __jsx(\"div\", {\n    className: \"w-full flex pt-4\"\n  }, \"Not enough funds in escrow...\"), __jsx(\"div\", {\n    className: \"w-full flex pt-4\"\n  }, isConnected ? __jsx(\"button\", {\n    type: \"submit\",\n    disabled: submitting,\n    className: \"btn-blue m-auto\"\n  }, \"Pay\") : __jsx(\"div\", {\n    className: \"m-auto\"\n  }, __jsx(Account, {\n    triedToEagerConnect: triedToEagerConnect\n  }))));\n}","map":null,"metadata":{},"sourceType":"module"}