"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.compileDestination = exports.matchPath = void 0;
const path_to_regexp_1 = require("path-to-regexp");
function matchPath(path, source) {
    const matcher = path_to_regexp_1.match(source, { decode: decodeURIComponent });
    return matcher(path);
}
exports.matchPath = matchPath;
function compileDestination(destination, params) {
    try {
        const destinationLowerCase = destination.toLowerCase();
        if (destinationLowerCase.startsWith("https://") ||
            destinationLowerCase.startsWith("http://")) {
            const { origin, pathname } = new URL(destination);
            const toPath = path_to_regexp_1.compile(pathname, { encode: encodeURIComponent });
            const compiledDestination = `${origin}${toPath(params)}`;
            if (!destination.endsWith("/") && compiledDestination.endsWith("/")) {
                return compiledDestination.slice(0, -1);
            }
            else {
                return compiledDestination;
            }
        }
        else {
            const escapedDestination = destination.replace(/\?/g, "\\?");
            const toPath = path_to_regexp_1.compile(escapedDestination, {
                encode: encodeURIComponent
            });
            return toPath(params);
        }
    }
    catch (error) {
        console.error(`Could not compile destination ${destination}, returning null instead. Error: ${error}`);
        return null;
    }
}
exports.compileDestination = compileDestination;
